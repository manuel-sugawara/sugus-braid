# Sugus :: Bride

This project is a [Smithy](https://smithy.io/) Java code generator. At
its core it doesn't do any code generation, instead it's configured
using plugins that configures different code generators or modifiers
that can rewrite artifacts generated by previous stages. Its aim is to
experiment with other techniques for code generation that can be
reused or freely extended/tailor to just not generate SDKs but also
any other Java code that can be itself expressed using a Smithy model.

## Examples

```smithy
$version: "2.0"

namespace mx.sugus.syntax.java

/// A simple structure shape one
structure StructureShape1 {
    @required
    name: String

    intValue: Integer
}
```

Generates the following Java classxb

```java
package mx.sugus.braid.test;

import java.util.Objects;
import mx.sugus.braid.rt.util.annotations.Generated;

/**
 * <p>A simple structure shape one</p>
 */
@Generated("mx.sugus.braid.plugins.data#DataPlugin")
public final class StructureShape1 {
    private final String name;
    private final Integer intValue;

    private StructureShape1(Builder builder) {
        this.name = Objects.requireNonNull(builder.name, "name");
        this.intValue = builder.intValue;
    }

    public String name() {
        return this.name;
    }

    public Integer intValue() {
        return this.intValue;
    }

    /**
     * Returns a new builder to modify a copy of this instance
     */
    public Builder toBuilder() {
        return new Builder(this);
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null || getClass() != obj.getClass()) {
            return false;
        }
        StructureShape1 that = (StructureShape1) obj;
        return this.name.equals(that.name)
            && Objects.equals(this.intValue, that.intValue);
    }

    @Override
    public int hashCode() {
        int hashCode = 17;
        hashCode = 31 * hashCode + name.hashCode();
        hashCode = 31 * hashCode + (intValue != null ? intValue.hashCode() : 0);
        return hashCode;
    }

    @Override
    public String toString() {
        return "StructureShape1{"
            + "name: " + name
            + ", intValue: " + intValue + "}";
    }

    /**
     * <p>Creates a new builder</p>
     */
    public static Builder builder() {
        return new Builder();
    }

    public static final class Builder {
        private String name;
        private Integer intValue;

        Builder() {
        }

        Builder(StructureShape1 data) {
            this.name = data.name;
            this.intValue = data.intValue;
        }

        /**
         * <p>Sets the value for <code>name</code></p>
         */
        public Builder name(String name) {
            this.name = name;
            return this;
        }

        /**
         * <p>Sets the value for <code>intValue</code></p>
         */
        public Builder intValue(Integer intValue) {
            this.intValue = intValue;
            return this;
        }

        public StructureShape1 build() {
            return new StructureShape1(this);
        }
    }
}
```

## Organization

### braid-core

Defines the Smithy plugin that runs the code generation pipeline along
side with all the adjacent types to create plugins to extend it.

### braid-java-syntax

An API to create Java syntax, similar and inspired by
[Java Poet](https://github.com/square/javapoet). The API is defined
itself using Smithy, see below.

### braid-java-syntax-model

The Smithy model for Java Syntax. This is the best example of what the
code generation looks like and what it can do at the moment.

### braid-java-syntax-model-plugin

A plugin to add some sugar to the generated classes from the
`braid-java-syntax-model` model.

### braid-data-plugin

A plugin to generate non-service shapes, supported shapes include

* Structures
* Unions
* Enums
* Simple types

It generates record alike, fully immutable, classes with fluent
builders. The builder also creates "adders" for all the fields
targeting aggregated shapes (map and lists). Lists that have the
[`@uniqueItems`](https://smithy.io/2.0/spec/constraint-traits.html#uniqueitems-trait)
are mapped to Java `Set`.

### braid-serde-node-plugin

A plugin to add serialization and deserialization of shapes using
Smithy Node classes that serializes to JSON.

### braid-syntax-plugin

A plugin to add visitors to shapes. It adds `accept` methods to the
generated classes and generates the visitor interface and default
implementation.

See how it's used and the classes generated in the
`braid-java-syntax-model` folder.

### braid-traits

This package defines several traits to be used to tailor the generated
Java code. Those are only supported by this package and will be most likely
**ignored** by any other Smithy tool.

The modeling traits include;

* `@const(<enum-value)` Valid for members, the data code generation
  will create an accessor that returns the given enum value.
* `@interface` Valid for structures. the data code generation will
  generate an interface instead of a concrete class.
* `@implements(<shapes>)` Valid for structures, marks the structures
  as implementers of the given interface or interfaces. The data
  codegen will add the corresponding "implements" clauses to the
  generated class.
* `@java(<class-name>)` Valid for all types. Allows to map structures
  in the Smithy model to concrete Java classes.

And other, higly experimental, traits that helps adding methods to the
builder for a more pleasant user experience.

### braid-java-codegen-test

A package to test the code generation. Nothing much test done as of now.

### braid-rt-util

Runtime utils. This package defines the `BuilderReference<P, T>` type
and its extension `CollectionBuilderReference<T>` that is extensively
used in the generated code to avoid unnecessary copying of
collections when using builders.

## License

Same as Smithy, Apache 2.0, see [LICENSE](LICENSE).

## Disclaimer

The ideas explored on this package were develop on my own capacity and
do not necessarily reflect the views of the Smithy project or my
current employer AWS.
